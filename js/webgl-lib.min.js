function OrbitCam(t,e,i,r,s,a,o,h){Camera.call(this,s,a,o,h),this.zoomZ=t,this.angleX=e,this.angleY=i,this.orbitPoint=vec3.create(),vec3.scale(this.orbitPoint,r,-1),this.updateView()}var Camera=function(t,e,i,r){this.viewMatrix=mat4.create(),this.scaleMatrix=mat4.create(),this.projMatrix=mat4.create(),this.projViewMatrix=mat4.create(),this.eye=vec4.create(),this.look=vec4.create(),this.up=vec4.create(),this.right=vec4.create(),this.fovy=t,this.aspect=e,this.near=i,this.far=r,this.H=this.far*Math.tan(degToRad(this.fovy/2)),this.C=-this.near/this.far,this.updateProjection()};Camera.prototype.updateProjection=function(){var t=this.aspect*this.H;this.scaleMatrix[0]=1/t,this.scaleMatrix[5]=1/this.H,this.scaleMatrix[10]=1/this.far,mat4.identity(this.projMatrix),this.projMatrix[10]=-1/(1+this.C),this.projMatrix[11]=-1,this.projMatrix[14]=this.C/(1+this.C),this.projMatrix[15]=0,mat4.multiply(this.projMatrix,this.projMatrix,this.scaleMatrix),mat4.multiply(this.projViewMatrix,this.projMatrix,this.viewMatrix)},OrbitCam.prototype=Object.create(Camera.prototype),OrbitCam.prototype.constructor=OrbitCam,OrbitCam.prototype.updateView=function(){mat4.identity(this.viewMatrix),mat4.translate(this.viewMatrix,this.viewMatrix,[0,0,this.zoomZ]),mat4.rotate(this.viewMatrix,this.viewMatrix,degToRad(this.angleY),[1,0,0]),mat4.rotate(this.viewMatrix,this.viewMatrix,degToRad(this.angleX),[0,1,0]),mat4.translate(this.viewMatrix,this.viewMatrix,this.orbitPoint);var t=mat4.create();mat4.invert(t,this.viewMatrix),vec4.transformMat4(this.eye,[0,0,0,1],t),mat4.identity(t),mat4.rotate(t,t,degToRad(this.angleX),[0,-1,0]),mat4.rotate(t,t,degToRad(this.angleY),[-1,0,0]),vec4.transformMat4(this.look,[0,0,-1,0],t),vec4.transformMat4(this.up,[0,1,0,0],t),vec4.transformMat4(this.right,[1,0,0,0],t),mat4.multiply(this.projViewMatrix,this.projMatrix,this.viewMatrix)},OrbitCam.prototype.updateOrbitPoint=function(t){var e=vec3.create(),i=vec3.create();vec3.normalize(e,[this.look[0],0,this.look[2]]),vec3.scale(e,e,t[2]),vec3.normalize(i,[this.right[0],0,this.right[2]]),vec3.scale(i,i,t[0]),vec3.add(t,e,[0,this.up[1]<0?-t[1]:t[1],0]),vec3.add(t,i,t),vec3.subtract(this.orbitPoint,this.orbitPoint,t)},OrbitCam.prototype.setOrbitPoint=function(t){this.orbitPoint=vec3.clone(t),vec3.scale(this.orbitPoint,this.orbitPoint,-1)};var LibGL=function(){this.gl,this.exts,this.canvas_div,this.Program=makeStruct("program attributes uniforms initialized"),this.Cubemap=makeStruct("program texture"),this.Primitive=makeStruct("type trans invT color settings texture"),this.Light=makeStruct("type posDir power radius radiance trans"),this.Model=makeStruct("vbo trans invT color settings texture"),this.Buffer=makeStruct("vbo trans invT color settings texture drawMode"),this.programs={},this.textures={},this.cubemaps={},this.models={},this.buffers={},this.HTMLElements={},this.framebuffers={},this.primitives=[],this.lights=[],this.MAX_LIGHTS=10,this.lightScale=0,this.ambientRadiance=vec3.create(),this.quadXY=null,this.quadXZ=null,this.sphere=null,this.cylinder=null,this.cubemapVBO=null,this.camera=null,this.mouseDown=!1,this.lastMouseX=null,this.lastMouseY=null,this.currentlyPressedKeys={},this.moveCamera=!1,this.spaceDown=!1,this.isTicking=!1,this.requestId=void 0,this.lastTime=0};LibGL.prototype.setUpGL=function(t,e,i){i="undefined"!=typeof i?i:1;try{2==i&&(this.gl=t.getContext("webgl2")||t.getContext("experimental-webgl2"),this.gl||console.log("Couldn't initialize WebGL 2.0")),1!=i&&this.gl||(this.gl=t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(r){}this.gl||alert("WebGL couldn't be initialized :-(. Try using a current version of Firefox or Chrome.");var s=e.length;this.exts=new Array(s);for(var a=0;s>a;++a){try{this.exts[a]=this.gl.getExtension(e[a])}catch(r){}this.exts[a]||console.log("Browser doesn't support "+e[a]+" extension sorry :-(")}this.gl.enable(this.gl.DEPTH_TEST),this.gl.enable(this.gl.POLYGON_OFFSET_FILL),this.gl.polygonOffset(-1,-1),this.gl.enable(this.gl.CULL_FACE),this.gl.cullFace(this.gl.BACK),this.gl.frontFace(this.gl.CCW),this.initShapes()},LibGL.prototype.addProgram=function(t,e,i,r,s){this.programs[t]=new this.Program(void 0,{},{},!1);var a=this;this.loadVertFragProgram(e,i,function(e){var i=a.programs[t];i.program=e,a.gl.useProgram(e);for(var o=r.length,h=0;o>h;++h)i.attributes[r[h]]=a.gl.getAttribLocation(e,r[h]),a.gl.enableVertexAttribArray(i.attributes[r[h]]);o=s.length;for(var h=0;o>h;++h)i.uniforms[s[h]]=a.gl.getUniformLocation(e,s[h]);i.initialized=!0})},LibGL.prototype.useProgram=function(t){return this.gl.useProgram(this.programs[t].program)},LibGL.prototype.getProgram=function(t){return this.programs[t].program},LibGL.prototype.getAttribute=function(t,e){return this.programs[t].attributes[e]},LibGL.prototype.getUniform=function(t,e){return this.programs[t].uniforms[e]},LibGL.prototype.isInitializedProgram=function(t){return this.programs[t].initialized},LibGL.prototype.isAllProgramsInitialized=function(){for(var t=Object.keys(this.programs),e=t.length,i=0;e>i;++i)if(!this.programs[t[i]].initialized)return!1;return!0};var LightType=Object.freeze({POINT:0,DIRECTIONAL:1,NUM_LIGHT_TYPES:2});LibGL.prototype.initShapes=function(){this.quadXY=new QuadXY(50,50,1),this.quadXZ=new QuadXZ(50,50,1),this.sphere=new Sphere(50,50,1),this.cylinder=new Cylinder(50,50,1,1),this.quadXY.createVBO(this.gl,!0,!0),this.quadXZ.createVBO(this.gl,!0,!0),this.sphere.createVBO(this.gl,!0,!0),this.cylinder.createVBO(this.gl,!0,!0)},LibGL.prototype.createPrimitive=function(t,e,i,r,s){var a=mat4.create();return mat4.invert(a,e),mat4.transpose(a,a),new this.Primitive(t,mat4.clone(e),a,i,r,s)},LibGL.prototype.addPrimitive=function(t,e,i,r,s){return this.primitives.push(this.createPrimitive(t,e,i,r,s)),this.primitives[this.primitives.length-1]},LibGL.prototype.renderPrimitives=function(t,e,i,r){r="undefined"!=typeof r?r:this.primitives;for(var s=r.length,a=0;s>a;++a)this.renderPrimitive(r[a],t,e,i)},LibGL.prototype.renderPrimitive=function(t,e,i,r){switch(i(t,e,r),t.texture.length>0&&(this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.getTexture(t.texture)),this.gl.uniform1i(this.getUniform(e,"uTexture"),0)),t.type){case ShapeType.CYLINDER:this.cylinder.bindBuffer(this.gl,this.getAttribute(e,"aPosition"),this.getAttribute(e,"aNormal"),this.getAttribute(e,"aTexCoord")),this.cylinder.render(this.gl);break;case ShapeType.SPHERE:this.sphere.bindBuffer(this.gl,this.getAttribute(e,"aPosition"),this.getAttribute(e,"aNormal"),this.getAttribute(e,"aTexCoord")),this.sphere.render(this.gl);break;case ShapeType.QUADXY:this.quadXY.bindBuffer(this.gl,this.getAttribute(e,"aPosition"),this.getAttribute(e,"aNormal"),this.getAttribute(e,"aTexCoord")),this.quadXY.render(this.gl);break;case ShapeType.QUADXZ:this.quadXZ.bindBuffer(this.gl,this.getAttribute(e,"aPosition"),this.getAttribute(e,"aNormal"),this.getAttribute(e,"aTexCoord")),this.quadXZ.render(this.gl)}},LibGL.prototype.addLight=function(t,e,i,r){t==LightType.DIRECTIONAL&&(r=1);var s=vec3.create(),a=4*Math.PI*Math.PI*r*r;vec3.scale(s,i,1/a);var o=mat4.create();t==LightType.POINT&&(mat4.translate(o,o,e),mat4.scale(o,o,[r,r,r])),this.lights.push(new this.Light(t,e,i,r,s,o))},LibGL.prototype.setLights=function(t,e,i,r){for(var s,a=this.lights.length,o=0;a>o;++o)s=this.lights[o],e(s,t,i,o),r&&s.type==LightType.POINT&&(this.sphere.bindBuffer(this.gl,this.getAttribute(t,"aPosition"),this.getAttribute(t,"aNormal"),this.getAttribute(t,"aTexCoord")),this.sphere.render(this.gl))},LibGL.prototype.handleLoadedModel=function(t,e,i){for(var r,s=t.geometries[0].data.faces,a=t.geometries[0].data.vertices,o=t.geometries[0].data.uvs[0],h=t.geometries[0].data.normals,t=[],n=[0,0,0],l=s.length,g=0;l>g;)56==s[g]?r=1:40==s[g]&&(r=0),n=[3*s[g+1],2*s[g+4],3*s[g+r+7]],t.push(a[n[0]]),t.push(a[n[0]+1]),t.push(a[n[0]+2]),t.push(h[n[2]]),t.push(h[n[2]+1]),t.push(h[n[2]+2]),t.push(o[n[1]]),t.push(o[n[1]+1]),n=[3*s[g+2],2*s[g+5],3*s[g+r+8]],t.push(a[n[0]]),t.push(a[n[0]+1]),t.push(a[n[0]+2]),t.push(h[n[2]]),t.push(h[n[2]+1]),t.push(h[n[2]+2]),t.push(o[n[1]]),t.push(o[n[1]+1]),n=[3*s[g+3],2*s[g+6],3*s[g+r+9]],t.push(a[n[0]]),t.push(a[n[0]+1]),t.push(a[n[0]+2]),t.push(h[n[2]]),t.push(h[n[2]+1]),t.push(h[n[2]+2]),t.push(o[n[1]]),t.push(o[n[1]+1]),1==r?g+=11:0==r&&(g+=10);i.vbo=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,i.vbo),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(t),this.gl.STATIC_DRAW),i.vbo.itemSize=8,i.vbo.numItems=t.length/i.vbo.itemSize,this.models[e]=i},LibGL.prototype.loadModelJSON=function(t,e,i){var r=this;loadFile(t,0,function(t,s){r.handleLoadedModel(JSON.parse(t),e,i)},function(t){alert('Failed to download "'+t+'"')})},LibGL.prototype.addModelJSON=function(t,e,i,r,s,a){var o=mat4.create();mat4.invert(o,i),mat4.transpose(o,o);var h=new this.Model(null,mat4.clone(i),o,r,s,a);this.loadModelJSON(e,t,h)},LibGL.prototype.renderModels=function(t,e,i){for(var r=Object.keys(this.models),s=r.length,a=0;s>a;++a)this.renderModel(r[a],t,e,i)},LibGL.prototype.renderModel=function(t,e,i,r){var s=this.models[t];s.vbo&&(i(s,e,r),s.texture.length>0&&(this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.getTexture(s.texture)),this.gl.uniform1i(this.getUniform(e,"uTexture"),0)),this.bindBuffer(s.vbo,this.getAttribute(e,"aPosition"),this.getAttribute(e,"aNormal"),this.getAttribute(e,"aTexCoord")),this.gl.drawArrays(this.gl.TRIANGLES,0,s.vbo.numItems))},LibGL.prototype.getBuffer=function(t){return this.buffers[t]},LibGL.prototype.addBuffer=function(t,e,i,r,s,a,o,h){var n=mat4.create();mat4.invert(n,r),mat4.transpose(n,n);var l=new this.Buffer(null,mat4.clone(r),n,s,a,o,h);l.vbo=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,l.vbo),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(e),this.gl.STATIC_DRAW),l.vbo.itemSize=i,l.vbo.numItems=e.length/l.vbo.itemSize,this.buffers[t]=l},LibGL.prototype.bindBuffer=function(t,e,i,r){var s=Float32Array.BYTES_PER_ELEMENT,a=s*t.itemSize;this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),1==t.itemSize?this.gl.vertexAttribPointer(e,1,this.gl.FLOAT,!1,a,0):2==t.itemSize?this.gl.vertexAttribPointer(e,2,this.gl.FLOAT,!1,a,0):this.gl.vertexAttribPointer(e,3,this.gl.FLOAT,!1,a,0),t.itemSize>5&&this.gl.vertexAttribPointer(i,3,this.gl.FLOAT,!1,a,3*s),5==t.itemSize?this.gl.vertexAttribPointer(r,2,this.gl.FLOAT,!1,a,3*s):8==t.itemSize&&this.gl.vertexAttribPointer(r,2,this.gl.FLOAT,!1,a,6*s)},LibGL.prototype.renderBuffers=function(t,e,i){for(var r=Object.keys(this.buffers),s=r.length,a=0;s>a;++a)this.renderBuffer(r[a],t,e,i)},LibGL.prototype.renderBuffer=function(t,e,i,r){var s=this.buffers[t];s.vbo&&(i(s,e,r),s.texture.length>0&&(this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.getTexture(s.texture)),this.gl.uniform1i(this.getUniform(e,"uTexture"),0)),this.bindBuffer(s.vbo,this.getAttribute(e,"aPosition"),this.getAttribute(e,"aNormal"),this.getAttribute(e,"aTexCoord")),this.gl.drawArrays(s.drawMode,0,s.vbo.numItems))},LibGL.prototype.addFramebuffer=function(t,e,i){var r;r=this.gl.createFramebuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,r),r.width=e,r.height=i;var s=this.gl.createRenderbuffer();this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,s),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,r.width,r.height),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,s),this.framebuffers[t]=r,this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)},LibGL.prototype.bindFramebuffer=function(t,e){t?(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.framebuffers[t]),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.getTexture(e),0)):this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)},LibGL.prototype.handleSingleTexture=function(t,e,i){t.bindTexture(t.TEXTURE_2D,e),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e.image),t.bindTexture(t.TEXTURE_2D,null)},LibGL.prototype.setUpTexture=function(t,e,i,r,s,a){var o=this.gl.createTexture();if(this.gl.bindTexture(this.gl.TEXTURE_2D,o),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e,i,0,this.gl.RGBA,r,t),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.bindTexture(this.gl.TEXTURE_2D,null),s){o.image=new Image;var h=this;o.image.onload=function(){h.handleSingleTexture(h.gl,o,a)},o.image.crossOrigin="anonymous",o.image.src=s}return o},LibGL.prototype.updateTextureArray=function(t,e,i,r,s){var a=this.textures[t];this.gl.bindTexture(this.gl.TEXTURE_2D,a),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e,i,0,this.gl.RGBA,r,s),this.gl.bindTexture(this.gl.TEXTURE_2D,null)},LibGL.prototype.setTextureParams=function(t,e,i,r,s){this.gl.bindTexture(this.gl.TEXTURE_2D,this.getTexture(t)),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,i),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,r),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,s),this.gl.bindTexture(this.gl.TEXTURE_2D,null)},LibGL.prototype.addTexture=function(t,e,i,r,s,a,o){o="undefined"!=typeof o?o:!1,this.textures[t]=this.setUpTexture(e,i,r,s,a,o)},LibGL.prototype.getTexture=function(t){return this.textures[t]},LibGL.prototype.handleCubemapTexture=function(t,e,i,r,s){t.bindTexture(t.TEXTURE_CUBE_MAP,e),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,s),t.texImage2D(i,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.bindTexture(t.TEXTURE_CUBE_MAP,null)},LibGL.prototype.prepCubemapTexture=function(t,e,i,r){for(var s=this.gl.createTexture(),a=new Uint8Array(i*i*4),o=0,h=0;i>h;++h)for(var n=0;i>n;++n)a[o++]=t[0],a[o++]=t[1],a[o++]=t[2],a[o++]=t[3];this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,s),this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X,0,this.gl.RGBA,i,i,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,a),this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,0,this.gl.RGBA,i,i,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,a),this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,0,this.gl.RGBA,i,i,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,a),this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,this.gl.RGBA,i,i,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,a),this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,0,this.gl.RGBA,i,i,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,a),this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,this.gl.RGBA,i,i,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,a),this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,null);var l=new Image,g=new Image,u=new Image,p=new Image,c=new Image,m=new Image,d=this;return l.onload=function(){d.handleCubemapTexture(d.gl,s,d.gl.TEXTURE_CUBE_MAP_POSITIVE_X,l,!1)},g.onload=function(){d.handleCubemapTexture(d.gl,s,d.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,g,!1)},u.onload=function(){d.handleCubemapTexture(d.gl,s,d.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,u,!0)},p.onload=function(){d.handleCubemapTexture(d.gl,s,d.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,p,!0)},c.onload=function(){d.handleCubemapTexture(d.gl,s,d.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,c,!1)},m.onload=function(){d.handleCubemapTexture(d.gl,s,d.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,m,!1)},l.src=e+"/xpos"+r,g.src=e+"/xneg"+r,u.src=e+"/ypos"+r,p.src=e+"/yneg"+r,c.src=e+"/zpos"+r,m.src=e+"/zneg"+r,s},LibGL.prototype.setCubeMap=function(t,e,i,r,s,a){var o=1;if(!this.cubemapVBO){var h=[-o,o,o,o,o,o,-o,-o,o,o,-o,o,o,-o,-o,o,o,o,o,o,-o,-o,o,o,-o,o,-o,-o,-o,o,-o,-o,-o,o,-o,-o,-o,o,-o,o,o,-o];this.cubemapVBO=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.cubemapVBO),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(h),this.gl.STATIC_DRAW),this.cubemapVBO.itemSize=3,this.cubemapVBO.numItems=h.length/3}var n=this.prepCubemapTexture(i,r,s,a);this.cubemaps[t]=new this.Cubemap(e,n)},LibGL.prototype.renderCubeMap=function(t){var e=this.cubemaps[t];this.useProgram(e.program),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.cubemapVBO);var i=Float32Array.BYTES_PER_ELEMENT*this.cubemapVBO.itemSize;this.gl.vertexAttribPointer(this.getAttribute("cubemap","aPosition"),3,this.gl.FLOAT,!1,i,0),this.gl.uniformMatrix4fv(this.getUniform(e.program,"uPMatrix"),!1,this.camera.projMatrix),this.gl.uniformMatrix4fv(this.getUniform(e.program,"uVMatrix"),!1,this.camera.viewMatrix),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,e.texture),this.gl.uniform1i(this.getUniform(e.program,"uEnvMap"),0),this.gl.depthMask(!1),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,this.cubemapVBO.numItems),this.gl.depthMask(!0)},LibGL.prototype.setTogglePanels=function(t){for(var e=t.length,i=0;e>i;++i)this.setTogglePanel(t[i])},LibGL.prototype.setTogglePanel=function(t){var e=this;document.getElementById(t[0]).onclick=function(){var i=e.toggleShow(t[1]);void 0!==t[2]&&t[2](t[0],t[1],i)}},LibGL.prototype.addLinkedInput=function(t,e){var i=document.getElementById(t),r=document.getElementById(e);i.oninput=function(){r.value=this.value},r.onchange=function(){i.value=this.value,this.value=i.value},this.HTMLElements[t]=i},LibGL.prototype.addHTMLElement=function(t){var e=document.getElementById(t);this.HTMLElements[t]=e},LibGL.prototype.handleMouseDown=function(t){this.mouseDown=!0;var e=this.getMousePos(t);this.lastMouseX=e.x,this.lastMouseY=e.y},LibGL.prototype.handleMouseUp=function(t){this.mouseDown=!1},LibGL.prototype.handleMouseWheel=function(t){t.preventDefault(),this.moveCamera&&this.updateZoomZ(.03*t.deltaY),this.updateView()},LibGL.prototype.handleMouseMove=function(t){if(this.mouseDown){var e=this.getMousePos(t),i=e.x-this.lastMouseX,r=e.y-this.lastMouseY;this.moveCamera&&(this.updateAngleX(.25*i),this.updateAngleY(.25*r)),this.lastMouseX=e.x,this.lastMouseY=e.y,this.updateView()}},LibGL.prototype.handleKeyDown=function(t){switch(this.currentlyPressedKeys[t.keyCode]=!0,t.keyCode){case 224:case 17:case 91:case 93:break;case 16:this.moveCamera=!0;break;case 32:this.spaceDown=!0,t.preventDefault()}},LibGL.prototype.handleKeyUp=function(t){switch(this.currentlyPressedKeys[t.keyCode]=!1,t.keyCode){case 224:case 17:case 91:case 93:break;case 16:this.moveCamera=!1;break;case 32:this.spaceDown=!1}},LibGL.prototype.handleInput=function(){var t=.25;this.moveCamera&&(t=.05);var e=[0,0,0];this.currentlyPressedKeys[87]&&(e[2]+=1),this.currentlyPressedKeys[65]&&(e[0]-=1),this.currentlyPressedKeys[83]&&(e[2]-=1),this.currentlyPressedKeys[68]&&(e[0]+=1),vec3.dot(e,e)>.001&&vec3.normalize(e,e),this.currentlyPressedKeys[81]&&(e[1]-=1),this.currentlyPressedKeys[69]&&(e[1]+=1),vec3.dot(e,e)>.001&&(vec3.scale(e,e,t),this.camera.updateOrbitPoint(e),this.updateView())},LibGL.prototype.addOrbitCam=function(t,e,i,r,s,a,o,h){this.camera=new OrbitCam(t,e,i,r,s,a,o,h),this.camera.updateView()},LibGL.prototype.getViewMatrix=function(){return this.camera.viewMatrix},LibGL.prototype.getProjMatrix=function(){return this.camera.projMatrix},LibGL.prototype.getProjViewMatrix=function(){return this.camera.projViewMatrix},LibGL.prototype.getScaleMatrix=function(){return this.camera.scaleMatrix},LibGL.prototype.getEye=function(){return this.camera.eye},LibGL.prototype.getLook=function(){return this.camera.look},LibGL.prototype.getUp=function(){return this.camera.up},LibGL.prototype.getRight=function(){return this.camera.right},LibGL.prototype.getZoomZ=function(){return this.camera.zoomZ},LibGL.prototype.updateZoomZ=function(t){this.camera.zoomZ+=t},LibGL.prototype.updateAngleX=function(t){this.camera.angleX+=t},LibGL.prototype.updateAngleY=function(t){this.camera.angleY+=t},LibGL.prototype.setAngleX=function(t){this.camera.angleX=t},LibGL.prototype.setAngleY=function(t){this.camera.angleY=t},LibGL.prototype.setZoomZ=function(t){this.camera.zoomZ=t},LibGL.prototype.updateView=function(){this.camera.updateView()},LibGL.prototype.updateProjection=function(){this.camera.updateProjection()},LibGL.prototype.resize=function(t,e){this.gl.canvas.width=t,this.gl.canvas.height=e,this.gl.viewportWidth=this.gl.canvas.width,this.gl.viewportHeight=this.gl.canvas.height,this.camera.aspect=this.gl.viewportWidth/this.gl.viewportHeight,this.camera.updateProjection()},LibGL.prototype.resizeCanvas=function(){this.resize(window.innerWidth,window.innerHeight),this.render()},LibGL.prototype.setCameraAndLightUniforms=function(t){this.gl.uniformMatrix4fv(this.getUniform(t,"uPVMatrix"),!1,this.camera.projViewMatrix),this.gl.uniform1f(this.getUniform(t,"uLightScale"),this.lightScale),this.gl.uniform3fv(this.getUniform(t,"uAmbientRadiance"),this.ambientRadiance);var e=this.lights.length;e<this.MAX_LIGHTS&&this.gl.uniform1i(this.gl.getUniformLocation(this.getProgram(t),"uLights["+e+"].type"),-1)},LibGL.prototype.setLightUniforms=function(t,e,i,r){var s=this.getProgram(e);this.gl.uniform1i(this.gl.getUniformLocation(s,"uLights["+r+"].type"),t.type),this.gl.uniform3fv(this.gl.getUniformLocation(s,"uLights["+r+"].posDir"),t.posDir),this.gl.uniform3fv(this.gl.getUniformLocation(s,"uLights["+r+"].radiance"),t.radiance),this.gl.uniform4f(this.getUniform(e,"uShapeSettings"),1,1,1,1);var a=vec3.create();vec3.scale(a,t.radiance,1/this.lightScale),this.gl.uniform3fv(this.getUniform(e,"uColor"),a),this.gl.uniformMatrix4fv(this.getUniform(e,"uMMatrix"),!1,t.trans)},LibGL.prototype.setShapeUniforms=function(t,e,i){this.gl.uniform4fv(this.getUniform(e,"uShapeSettings"),t.settings),this.gl.uniform3f(this.getUniform(e,"uColor"),t.color[0],t.color[1],t.color[2]),this.gl.uniformMatrix4fv(this.getUniform(e,"uMMatrix"),!1,t.trans),this.gl.uniformMatrix4fv(this.getUniform(e,"uMMatrixIT"),!1,t.invT)},LibGL.prototype.renderScene=function(t){this.useProgram(t),this.setCameraAndLightUniforms(t),this.setLights(t,this.setLightUniforms.bind(this),[],!0),this.renderPrimitives(t,this.setShapeUniforms.bind(this),[]),this.renderModels(t,this.setShapeUniforms.bind(this),[]),this.renderBuffers(t,this.setShapeUniforms.bind(this),[])},LibGL.prototype.render=function(){this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)},LibGL.prototype.tick=function(){requestAnimFrame(this.tick.bind(this));var t=(new Date).getTime();(t-this.lastTime)/1e3;this.lastTime=t,this.handleInput(),this.render()},LibGL.prototype.show=function(t,e){document.getElementById(t).style.display=e?"block":"none"},LibGL.prototype.toggleShow=function(t){var e=document.getElementById(t);return"block"==e.style.display?(e.style.display="none",!0):(e.style.display="block",!1)},LibGL.prototype.onStartTick=function(){this.resizeCanvas(),this.tick()},LibGL.prototype.continueLoadingScreen=function(){return this.isTicking?void this.onStartTick():(this.requestId=requestAnimFrame(this.continueLoadingScreen.bind(this)),void(this.isAllProgramsInitialized()&&(this.isTicking=!0)))},LibGL.prototype.start=function(){this.continueLoadingScreen()},LibGL.prototype.initShaders=function(){},LibGL.prototype.initTextures=function(){},LibGL.prototype.setScene=function(){},LibGL.prototype.init=function(t,e,i,r){this.canvas_div=e,this.setUpGL(t,i,r),this.initShaders(),this.initTextures(),this.addOrbitCam(-15,0,15,[0,0,0],45,1,.1,5e3),this.setScene(),this.gl.clearColor(0,0,0,1),t.onmousedown=this.handleMouseDown.bind(this),document.onmouseup=this.handleMouseUp.bind(this),document.onmousemove=this.handleMouseMove.bind(this),t.onwheel=this.handleMouseWheel.bind(this),document.onkeydown=this.handleKeyDown.bind(this),document.onkeyup=this.handleKeyUp.bind(this),window.onresize=this.resizeCanvas.bind(this)},LibGL.prototype.getMousePos=function(t){var e=this.gl.canvas.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}},LibGL.prototype.getRayBare=function(t,e,i){var r=2*i.x/this.gl.canvas.width-1,s=1-2*i.y/this.gl.canvas.height,a=vec4.create();return vec4.transformMat4(a,[r,s,-1,1],e),vec4.subtract(a,a,t),vec3.normalize(a,a),{o:t,d:a}},LibGL.prototype.getRay=function(t,e,i){var r=2*i.x/this.gl.canvas.width-1,s=1-2*i.y/this.gl.canvas.height,a=vec4.create();vec4.transformMat4(a,[r,s,-1,1],e),vec4.subtract(a,a,t),vec4.normalize(a,a),dirInv=[1/a[0],1/a[1],1/a[2]];var o=[dirInv[0]<0?1:0,dirInv[1]<0?1:0,dirInv[2]<0?1:0];return{o:t,d:a,di:dirInv,sign:o}},LibGL.prototype.loadVertFragProgram=function(t,e,i){var r=this;loadFiles([t,e],function(t){var e=r.gl.createShader(r.gl.VERTEX_SHADER),s=r.gl.createShader(r.gl.FRAGMENT_SHADER);if(r.gl.shaderSource(e,t[0]),r.gl.shaderSource(s,t[1]),r.gl.compileShader(e),r.gl.compileShader(s),!r.gl.getShaderParameter(e,r.gl.COMPILE_STATUS))return alert(r.gl.getShaderInfoLog(e)),null;if(!r.gl.getShaderParameter(s,r.gl.COMPILE_STATUS))return alert(r.gl.getShaderInfoLog(s)),null;var a=r.gl.createProgram();r.gl.attachShader(a,e),r.gl.attachShader(a,s),r.gl.linkProgram(a),r.gl.getProgramParameter(a,r.gl.LINK_STATUS)||alert("Could not initialize default shaders"),i(a)},function(t){alert('Failed to download "'+t+'"')})};